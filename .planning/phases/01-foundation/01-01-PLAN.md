---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - go.mod
  - go.sum
  - internal/domain/model/pullrequest.go
  - internal/domain/model/repository.go
  - internal/domain/model/review.go
  - internal/domain/model/reviewcomment.go
  - internal/domain/model/checkstatus.go
  - internal/domain/model/enums.go
  - internal/domain/port/driven/prstore.go
  - internal/domain/port/driven/repostore.go
  - internal/domain/port/driven/githubclient.go
  - internal/config/config.go
  - internal/config/config_test.go
autonomous: true

must_haves:
  truths:
    - "Domain entities exist as pure Go structs importing only stdlib time"
    - "Port interfaces reference only domain types and stdlib types"
    - "Config loader returns error with clear message when REVIEWHUB_GITHUB_TOKEN is missing"
    - "Config loader returns error with clear message when REVIEWHUB_GITHUB_USERNAME is missing"
    - "Config loader returns valid Config when all required env vars are set"
  artifacts:
    - path: "internal/domain/model/pullrequest.go"
      provides: "PullRequest entity"
      contains: "type PullRequest struct"
    - path: "internal/domain/model/repository.go"
      provides: "Repository entity"
      contains: "type Repository struct"
    - path: "internal/domain/model/review.go"
      provides: "Review entity"
      contains: "type Review struct"
    - path: "internal/domain/model/reviewcomment.go"
      provides: "ReviewComment entity"
      contains: "type ReviewComment struct"
    - path: "internal/domain/model/checkstatus.go"
      provides: "CheckStatus value object"
      contains: "type CheckStatus struct"
    - path: "internal/domain/model/enums.go"
      provides: "Status enums for PR, Review, CI"
      contains: "type PRStatus string"
    - path: "internal/domain/port/driven/prstore.go"
      provides: "PRStore interface"
      contains: "type PRStore interface"
    - path: "internal/domain/port/driven/repostore.go"
      provides: "RepoStore interface"
      contains: "type RepoStore interface"
    - path: "internal/domain/port/driven/githubclient.go"
      provides: "GitHubClient interface"
      contains: "type GitHubClient interface"
    - path: "internal/config/config.go"
      provides: "Config struct and Load function"
      exports: ["Config", "Load"]
    - path: "internal/config/config_test.go"
      provides: "Config loader tests"
      contains: "func Test"
  key_links:
    - from: "internal/domain/port/driven/prstore.go"
      to: "internal/domain/model/pullrequest.go"
      via: "import model package"
      pattern: "model\\.PullRequest"
    - from: "internal/domain/port/driven/repostore.go"
      to: "internal/domain/model/repository.go"
      via: "import model package"
      pattern: "model\\.Repository"
---

<objective>
Initialize the Go module, create all domain model entities as pure Go structs, define port interfaces for the hexagonal architecture driven layer, and implement the configuration loader with fail-fast validation.

Purpose: Establishes the innermost hexagonal rings (domain model + ports) and configuration loading that every subsequent plan depends on. Domain entities have zero external dependencies. Port interfaces define the contracts that SQLite adapters will implement in Plan 02.
Output: Go module initialized, 6 domain model files, 3 port interface files, config loader with tests.
</objective>

<execution_context>
@C:\Users\EFisher\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\EFisher\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Go module and create domain model entities with port interfaces</name>
  <files>
    go.mod
    internal/domain/model/pullrequest.go
    internal/domain/model/repository.go
    internal/domain/model/review.go
    internal/domain/model/reviewcomment.go
    internal/domain/model/checkstatus.go
    internal/domain/model/enums.go
    internal/domain/port/driven/prstore.go
    internal/domain/port/driven/repostore.go
    internal/domain/port/driven/githubclient.go
  </files>
  <action>
    1. Initialize Go module:
       ```
       go mod init github.com/efisher/reviewhub
       ```
       Ensure `go.mod` has `go 1.23` directive (required for enhanced net/http routing later).

    2. Create domain model entities in `internal/domain/model/`. Each entity is a pure Go struct importing ONLY `time` from stdlib. NO external dependencies, NO JSON tags, NO database tags.

    **enums.go** - Define typed string enums:
    - `PRStatus` with constants: `PRStatusOpen`, `PRStatusClosed`, `PRStatusMerged`
    - `ReviewState` with constants: `ReviewStateApproved`, `ReviewStateChangesRequested`, `ReviewStateCommented`, `ReviewStatePending`, `ReviewStateDismissed`
    - `CIStatus` with constants: `CIStatusPassing`, `CIStatusFailing`, `CIStatusPending`, `CIStatusUnknown`

    **pullrequest.go** - PullRequest struct with fields:
    - `ID int64`, `Number int`, `RepoFullName string`, `Title string`, `Author string`
    - `Status PRStatus`, `IsDraft bool`, `URL string`, `Branch string`, `BaseBranch string`
    - `Labels []string`
    - `OpenedAt time.Time`, `UpdatedAt time.Time`, `LastActivityAt time.Time`
    - Methods: `DaysSinceOpened() int`, `DaysSinceLastActivity() int`, `IsStale(thresholdDays int) bool`

    **repository.go** - Repository struct with fields:
    - `ID int64`, `FullName string`, `Owner string`, `Name string`, `AddedAt time.Time`

    **review.go** - Review struct with fields:
    - `ID int64`, `PRID int64`, `ReviewerLogin string`, `State ReviewState`
    - `Body string`, `SubmittedAt time.Time`, `IsBot bool`

    **reviewcomment.go** - ReviewComment struct with fields:
    - `ID int64`, `ReviewID int64`, `PRID int64`, `Author string`
    - `Body string`, `Path string`, `Line int`, `Side string`
    - `DiffHunk string`, `IsResolved bool`, `IsOutdated bool`
    - `InReplyToID *int64`, `CreatedAt time.Time`, `UpdatedAt time.Time`

    **checkstatus.go** - CheckStatus value object with fields:
    - `Name string`, `Status CIStatus`, `Conclusion string`
    - `IsRequired bool`, `DetailsURL string`

    3. Create port interfaces in `internal/domain/port/driven/`. Interfaces reference ONLY domain model types and stdlib types (context.Context).

    **prstore.go** - `PRStore` interface with methods:
    - `Upsert(ctx context.Context, pr model.PullRequest) error`
    - `GetByRepository(ctx context.Context, repoFullName string) ([]model.PullRequest, error)`
    - `GetByStatus(ctx context.Context, status model.PRStatus) ([]model.PullRequest, error)`
    - `GetByNumber(ctx context.Context, repoFullName string, number int) (*model.PullRequest, error)`
    - `ListAll(ctx context.Context) ([]model.PullRequest, error)`
    - `Delete(ctx context.Context, repoFullName string, number int) error`

    **repostore.go** - `RepoStore` interface with methods:
    - `Add(ctx context.Context, repo model.Repository) error`
    - `Remove(ctx context.Context, fullName string) error`
    - `GetByFullName(ctx context.Context, fullName string) (*model.Repository, error)`
    - `ListAll(ctx context.Context) ([]model.Repository, error)`

    **githubclient.go** - `GitHubClient` interface (defined now, implemented in Phase 2):
    - `FetchPullRequests(ctx context.Context, repoFullName string) ([]model.PullRequest, error)`
    - `FetchReviews(ctx context.Context, repoFullName string, prNumber int) ([]model.Review, error)`
    - `FetchReviewComments(ctx context.Context, repoFullName string, prNumber int) ([]model.ReviewComment, error)`

    CRITICAL: domain/model/ must have ZERO imports from any package outside stdlib. domain/port/driven/ must import ONLY the domain/model package and stdlib.
  </action>
  <verify>
    Run `go vet ./internal/domain/...` -- must pass with zero errors.
    Inspect imports in model/ files -- only `time` from stdlib.
    Inspect imports in port/ files -- only `context` and the domain model package.
  </verify>
  <done>
    All 6 domain model files exist with properly typed structs. All 3 port interface files exist with method signatures referencing only domain types. `go vet` passes on the domain package. Zero external dependencies in domain layer.
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement configuration loader with fail-fast validation and tests</name>
  <files>
    internal/config/config.go
    internal/config/config_test.go
  </files>
  <action>
    1. Create `internal/config/config.go`:
       - `Config` struct with fields: `GitHubToken string`, `GitHubUsername string`, `PollInterval time.Duration`, `ListenAddr string`, `DBPath string`
       - `Load() (*Config, error)` function that:
         - Reads `REVIEWHUB_GITHUB_TOKEN` via `os.LookupEnv` -- returns descriptive error if missing or empty
         - Reads `REVIEWHUB_GITHUB_USERNAME` via `os.LookupEnv` -- returns descriptive error if missing or empty
         - Reads `REVIEWHUB_POLL_INTERVAL` (optional, default `5m`) -- parses with `time.ParseDuration`, returns error if invalid format
         - Reads `REVIEWHUB_LISTEN_ADDR` (optional, default `127.0.0.1:8080`)
         - Reads `REVIEWHUB_DB_PATH` (optional, default `reviewhub.db`)
       - Error messages must be clear: `"REVIEWHUB_GITHUB_TOKEN is required but not set"`
       - Use ONLY stdlib (`os`, `fmt`, `time`). No external config libraries.

    2. Create `internal/config/config_test.go`:
       - Use `testify/assert` and `testify/require` for assertions
       - Test cases:
         a. **TestLoad_Success** -- Set both required vars + all optional vars, verify all fields populated correctly
         b. **TestLoad_Defaults** -- Set only required vars, verify defaults: PollInterval=5m, ListenAddr=127.0.0.1:8080, DBPath=reviewhub.db
         c. **TestLoad_MissingToken** -- Unset token, verify error contains "REVIEWHUB_GITHUB_TOKEN"
         d. **TestLoad_MissingUsername** -- Unset username, verify error contains "REVIEWHUB_GITHUB_USERNAME"
         e. **TestLoad_EmptyToken** -- Set token to empty string, verify error
         f. **TestLoad_InvalidPollInterval** -- Set invalid duration string, verify error contains "REVIEWHUB_POLL_INTERVAL"
       - Use `t.Setenv()` (Go 1.17+) for setting env vars in tests -- automatically cleans up after each test

    3. Install testify dependency:
       ```
       go get github.com/stretchr/testify
       ```
  </action>
  <verify>
    Run `go test ./internal/config/ -v` -- all 6 test cases pass.
    Run `go vet ./internal/config/` -- no errors.
  </verify>
  <done>
    Config loader reads 5 env vars with 2 required (fail-fast) and 3 optional (with sensible defaults). All 6 test cases pass. Error messages are descriptive and mention the specific env var name.
  </done>
</task>

</tasks>

<verification>
1. `go vet ./...` passes with zero errors across all packages
2. `go test ./internal/config/ -v` -- all config tests pass
3. Domain model files in `internal/domain/model/` import only `time`
4. Port interface files in `internal/domain/port/driven/` import only `context` and the model package
5. No circular dependencies (enforced by Go compiler)
</verification>

<success_criteria>
- 6 domain model files exist with pure Go structs (PullRequest, Repository, Review, ReviewComment, CheckStatus, enums)
- 3 port interface files exist (PRStore, RepoStore, GitHubClient) referencing only domain types
- Config loader passes all 6 test cases (success, defaults, missing token, missing username, empty token, invalid poll interval)
- `go vet ./...` clean
- Zero external dependencies in domain layer
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
